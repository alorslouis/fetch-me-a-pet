---
import { dogParser } from "@typedef/apiTypes";
import { z } from "zod";
import Layout from "@layouts/Layout.astro";
import { fetchFetch } from "src/utils/fetchFetch";
import { Image } from "astro:assets";

let { dogId } = Astro.params;

const dogIdParsed = z.string().safeParse(dogId);

if (!dogIdParsed.success) return Astro.redirect("/");

const getDog = await fetchFetch(Astro, {
	path: "/dogs",
	method: "POST",
	data: [dogIdParsed.data],
});

if (!getDog.ok) throw new Error(`failed fetching dogs`);

const dogs = dogParser.array().parse(await getDog.json());

const { img, name, breed } = dogs[0];
---

<Layout title={name}>
	<div class="flex gap-2 container mx-auto">
		<Image
			src={img}
			alt={`picture of ${name}, a ${breed}`}
			inferSize
			class="rounded-lg"
		/>
		<div class="flex flex-col text-center gap-2">
			{name}
		</div>
	</div>
</Layout>
